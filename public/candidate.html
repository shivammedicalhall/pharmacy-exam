// Inside your initCamera() function in candidate.html

async function initCamera() {
    const video = document.getElementById('camera-preview');
    // ... existing setup ...

    try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { width: 320, height: 240 } }); 
        // Request low resolution (320x240) to make transmission faster
        video.srcObject = stream;

        // BROADCAST LOOP
        setInterval(() => {
            // Check if exam is actually running before sending data (saves bandwidth)
            if (!examConfig.isActive) return;

            // Draw to hidden canvas
            const canvas = document.getElementById('hidden-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 160;  // Compress width (smaller = faster)
            canvas.height = 120; // Compress height
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            // Convert to JPEG (Quality 0.6 is good balance)
            const imgData = canvas.toDataURL('image/jpeg', 0.6);

            // Send to Examiner
            socket.emit('candidateStream', {
                roll: rollNo, // Defined in your login logic
                name: document.getElementById('uName').innerText,
                image: imgData
            });

            // ... your existing light detection logic can stay here ...

        }, 1000); // 1000ms = 1 Second (Standard CCTV refresh rate)

    } catch (e) {
        console.error(e);
    }
}